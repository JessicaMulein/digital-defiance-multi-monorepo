#!/bin/bash
OPWD=`pwd`
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"
cd "${SCRIPT_DIR}"
PACKAGES=`find . -not -path "*/node_modules/*" -not -path "./dist/*" -name package.json -type f`
for package in ${PACKAGES}; do
    echo ""
    echo "package: $package"
    PACKAGE_PATH=$(dirname $package)
    echo "Clearing node_modules"
    cd "${SCRIPT_DIR}/${PACKAGE_PATH}"
    if [ $? -ne 0 ]; then
        echo "Failed to cd to $PACKAGE_PATH"
        exit 1
    fi
    rm -rf node_modules/
    if [ $? -ne 0 ]; then
        echo "Failed to clear node_modules for $PACKAGE_PATH"
        exit 1
    fi
    cd "${OPWD}"
    if [ $? -ne 0 ]; then
        echo "Failed to cd to $OPWD"
        exit 1
    fi
done
cd "${OPWD}"
